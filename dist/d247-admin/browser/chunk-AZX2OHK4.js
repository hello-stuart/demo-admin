import{h as a}from"./chunk-F4ECYANF.js";import{aa as n,c as i,f as r,fa as o}from"./chunk-CKWEI2SK.js";var h="wss://casino.unityexch.com/universecasino?token=LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0NCk1JR2ZNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0R05BRENCaVFLQmdRQ0lTVUpsYUxTUVl4TXBrUUkwY1RrVXY5a0oNCklibUk3MU9zaEVLQXJudXNHMGt4SWJFZUFXMVNaak1JM3FpMGN3ME1ZWlJxSFpnSmkxOG5Lc0tOWmdNWlF3YTMNCitlRVBRc1p6QTZVMlk4bFp5R2dtdjIvTmRxQVlMNDJ5SXQraVMrYWxhQ0RGbzdzTGFUSzhhbkQyR2VYNnZFM2MNClVJT21BVEh0OXFIeHNEazlyd0lEQVFBQg0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tDQo=",c=class s{constructor(t){this.route=t;this.connect()}messages;resultMsg;socket;url=h;reconnectInterval=5e3;reconnectAttempts=1e3;currentReconnectAttempts=0;previousMsg;isAttempt=!1;reattempting=!1;marketData=new r;ngOnInit(){}getMarketData(){return this.marketData.asObservable()}updateMarketData(t){this.marketData.next(t)}connect(){return new i(t=>{this.socket=new WebSocket(this.url),this.socket.onmessage=e=>{t.next(e.data),this.marketData.next(e?.data=="unsubscribed successfully"?null:e.data)},this.socket.onerror=e=>{t.error(e)},this.socket.onclose=e=>{t.complete();try{this.reconnect()}catch{this.reconnect()}};try{setTimeout(()=>{this.socket&&this.isAttempt&&(this.previousMsg==null||this.previousMsg==null?(this.previousMsg={type:"2",id:""},this.send(this.previousMsg)):this.send(this.previousMsg))},1e3)}catch{setTimeout(()=>{this.socket&&this.isAttempt&&(this.previousMsg==null||this.previousMsg==null?(this.previousMsg={type:"2",id:""},this.send(this.previousMsg)):this.send(this.previousMsg))},1500)}return()=>{this.socket.close()}})}send(t){this.isAttempt=!1,this.previousMsg=t,this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify(t)),this.socket.onopen=()=>{if(this.socket&&this.socket.readyState===WebSocket.OPEN)this.socket.send(JSON.stringify(t));else try{this.socket.send(JSON.stringify(t))}catch{setTimeout(()=>{this.socket.send(JSON.stringify(t))},1e3)}}}ping(){setInterval(()=>{this.socket.readyState===WebSocket.OPEN&&this.send("Ping")},6e4)}receive(){return new i(t=>(this.socket.onmessage=e=>{t.next(e.data),this.marketData.next(e?.data)},this.socket.onerror=e=>{t.error(e)},this.socket.onclose=e=>{t.complete()},()=>{this.socket.close()}))}reconnect(){this.reattempting||(this.reattempting=!0,this.currentReconnectAttempts++,this.currentReconnectAttempts<=this.reconnectAttempts?setTimeout(()=>{this.isAttempt=!0,this.connect().subscribe(t=>{this.reattempting=!1},t=>{},()=>{this.reattempting=!1,this.reconnect()})},this.reconnectInterval):console.error("WebSocket connection failed after maximum reconnect attempts"))}static \u0275fac=function(e){return new(e||s)(o(a))};static \u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"})};export{c as a};
