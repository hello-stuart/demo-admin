import{a as f}from"./chunk-PW5J7ZGW.js";import{c as g,d as v}from"./chunk-3BRWB67J.js";import"./chunk-5UJXZMZS.js";import"./chunk-ACVM4ET5.js";import"./chunk-QZIUMNBJ.js";import{m as p,q as A}from"./chunk-TKUFSEQW.js";import{f as u}from"./chunk-F4ECYANF.js";import{Nb as d,O as l,Ob as c,Pb as o,cb as s,hd as y,mb as h}from"./chunk-CKWEI2SK.js";import"./chunk-ZR4K4ZIC.js";var I=class m{constructor(e,r,t,i){this.route=e;this.toaster=r;this.backendService=t;this.encyDecy=i;this.eventid=this.route.snapshot.params.id,this._roomId="",this.message.id=this.eventid,this.messageResult.id=this.eventid}subscription;subscription2;message={type:"1",id:""};messageResult={type:"3",id:""};eventid;myVideo=null;marketArray;rulesBox;game;_roomId;timer;winnerMarketArray;playerACards;playerBCards;gameroundId;Card;split_arr;changeValue;eventName;counter=0;RoundWinner;getRoundId="";selectedCell="";yesSelectedArray=[];noSelectedArray=[];noSelectedCardArray=[];yesSelectedCardArray=[];betplaceObjset;isbetInProcess=!1;ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this.subscription2&&this.subscription2.unsubscribe()}ngOnInit(){setTimeout(()=>{},2e3),this.encyDecy.generateEncryptionKey("",this.message),this.subscription=this.encyDecy.getMarketData().subscribe((e=[])=>{if(e){this.getRoundId=localStorage.getItem("roundID");let t=JSON.parse(e);if(Array.isArray(t.data)){if(t.type=="1"){let i=function(a){let n=a.match(/\d+(\.\d+)?/);return n?parseFloat(n[0]):null};var r=i;this.marketArray=t.data[0].marketArr,this.game=t.data[0],this.game.marketArr=this.marketArray?this.marketArray:t?.data[0]?.marketArr,this.eventName=t?.data[0]?.eventName,this.winnerMarketArray=this.game?.marketArr?this.game?.marketArr[0]:"";for(let a in this.winnerMarketArray.runnersName)this.winnerMarketArray.runnersName.hasOwnProperty(a)&&(this.winnerMarketArray.runnersName[a]=i(this.winnerMarketArray.runnersName[a]));this.handleEventResponse(t,0)}}else this.handleEventResponse(t,0);this.game&&(this.winnerMarketArray=this.game?.marketArr?this.game?.marketArr[0]:"",this.marketArray=this.game.marketArr,this.gameroundId=this.game.roundId,this.game.eventName=this.eventName?this.eventName:this.game.eventName,this.backendService.updateRoundId(this.game),(this.getRoundId!=this.game.roundId||this.getRoundId=="")&&(localStorage.setItem("roundID",this.game.roundId),this.getResults(),this.selectedCell=""),this.game.status=="SUSPEND"&&(this.backendService.setBetSlipPlaceData({}),this.yesSelectedArray=[],this.noSelectedArray=[],this.yesSelectedCardArray=[],this.noSelectedCardArray=[]),this.Card=this.game?.cardsArr?.card,this.winnerMarketArray=this.game.marketArr?this.game.marketArr[0]:"",this.marketArray=this.game?.marketArr)}}),this.getResults()}handleEventResponse(e,r){if(Array.isArray(e))e.forEach(t=>{this.marketObhManager(t)});else{let t=e;this.marketObhManager(t);return}}marketObhManager(e){if(e&&e.type=="1")if("data"in e&&this.counter==0&&e.data.marketArr&&e.data._id)this.marketArray=e.data.marketArr,this.game=this.marketArray?this.marketArray:e.data,this.game=e.data,this.eventName=e.data.eventName,this.counter=1;else{if("marketArr"in e?.data&&Array.isArray(e.data.marketArr)&&(this.game.marketArr=e.data.marketArr),"cardsArr"in e?.data&&(Array.isArray(e.data.cardsArr)||(this.game.cardsArr=e.data.cardsArr)),"roundId"in e&&(this.game.roundId=e.roundId),"status"in e?.data&&(this.game.status=e.data.status),"resultsArr"in e?.data){for(let t in e?.data?.resultsArr[0]?.runners)e.data?.resultsArr[0]?.runners[t]=="WINNER"&&(this.RoundWinner=e?.data?.resultsArr[0]?.runnersName[t],this.backendService.setResultData(this.RoundWinner)),e.data?.resultsArr[0]?.runners[t]=="WINNER"&&setTimeout(()=>{this.backendService.setResultSparkData(!0)},1e3);setTimeout(()=>{this.RoundWinner=null,this.backendService.setResultData(this.RoundWinner)},5e3)}var r=Object.keys(e.data)[0];if(r.includes(".")){this.split_arr=r.split("."),Object.entries(e.data).forEach(([,n])=>this.changeValue=n);let t=parseInt(this.split_arr[1]),i=this.split_arr[3],a=this.split_arr[6];this.split_arr[7]=="size"&&(this.marketArray[t].runners[i].price.back[a].size=this.changeValue),this.split_arr[7]=="price"&&(this.marketArray[t].runners[i].price.back[a].price=this.changeValue)}}}formatValue(e){let r=parseFloat(e);if(isNaN(r))return parseInt("0.00");let t=r%1!==0?r.toFixed(2):r.toString();return parseInt(t)}isKeyStringWithNo(e){return typeof e=="string"&&e.includes("NO")}isKeyStringWithYes(e){return typeof e=="string"&&e.includes("YES")}getResults(){this.backendService.getAllRecordsByPost(y.getCasinoResultURL,{eventId:this.eventid}).pipe(l()).subscribe(e=>{this.backendService.updateResultstream(e.data)},e=>{let r=e})}boxes=[5,10,15,20,25,50,75];cardList=[{card:"A",selectionId:"1"},{card:"2",selectionId:"2"},{card:"3",selectionId:"3"},{card:"4",selectionId:"4"},{card:"5",selectionId:"5"},{card:"6",selectionId:"6"},{card:"7",selectionId:"7"},{card:"8",selectionId:"8"},{card:"9",selectionId:"9"},{card:"10",selectionId:"0"}];static \u0275fac=function(r){return new(r||m)(s(u),s(p),s(A),s(v))};static \u0275cmp=h({type:m,selectors:[["app-lottery"]],decls:4,vars:0,template:function(r,t){r&1&&(d(0,"div"),o(1,"app-video-player"),c(),d(2,"div"),o(3,"app-resultbar"),c())},dependencies:[f,g],encapsulation:2})};export{I as LotteryComponent};
